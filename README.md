# srsRAN 7.2 + Open5Gs multi-tenant deployment
This repository will help you in deploying a **single core, multi-tenant, CU/DU split, neutral host O-RAN compliant** setup for 4 tenants.

## How to use the repository:
First of all, since this is a 7.2 split deployment, PTP synchronization is needed. The linuxptp chart can help you get started, but it needs to be edited with your PTP configuration.

The repository contains some simple yet useful Bash scripts that help you get up and running quickly. The scripts are especially useful when debugging issues that require a whole setup reboot.
The script redeploy.sh does the following:
- Uninstalls any previous deployments of this repo, to start with a clean state
- Pulls the latest version of this repository
- Builds dependencies
- Installs:
  - Open5Gs
  - InfluxDB
  - Grafana srsRAN monitoring stack

Once the script is done, everything is ready, except the RAN.
The next script to run is ran-redeploy-all.sh, which does the following:
-  Pulls the latest version of this repository
-  Uninstalls any previous RAN deployments of this repo (CU and DUs)
-  Installs:
  - one srsRAN CU
  - 4 srsRAN DUs

## How to edit this repository:
The most crucial files in this repository are the Open5GS values.yaml file, which contains the whole core setup (subnets, APNs, slices) and subscriber infos (IMSI and APNs), and the srsRAN CU/DUs gnb-template.yaml files, which contain the configuration of CU, DUs and O-RUs. Those files need to match the configuration of the core, especially regarding PLMNs and IPs. The DU gnb-template.yaml files also need to match the O-RU configuration or the fronthaul will NOT work. MAC addresses, VLANs, eAxc IDs, DPDK PCI addresses are especially important.

Some resources to help you get started:

srsRAN configuration (gnb-template.yaml) reference: https://docs.srsran.com/projects/project/en/latest/user_manuals/source/config_ref.html

srsRAN O-RAN 7.2 RU guide: https://docs.srsran.com/projects/project/en/latest/tutorials/source/oranRU/source/index.html

srsRAN DPDK tutorial: https://docs.srsran.com/projects/project/en/latest/tutorials/source/dpdk/source/index.html

## Additional scripts/tools

-  By default, the DU0 (srsran-5g-du) will also run a monitoring Python script that gathers metrics on all CPU cores and the whole CPU package; this can be very useful to see which threads are the most constrained and how to best allocate the srsRAN threads. The script saves its results to /mnt/data/monitoring, so be sure to create a PV/PVC mountpoint if you want the script to work.
-  On the UPF there are also some benchmarking scripts, useful to test the throughput in a multi-tenant scenario, with multiple UEs:
  -  iperf3-test.sh: runs an array of multiple iPerf3 tests, such as: UDP/TCP, single/parallel streams, uncapped/capped, constant/burst, uplink/downlink/bidirectional.

To use the script, on the UPF run /iperf3-test.sh <list of IPs:port iPerf3 servers> <number of runs>
  -  iperf3-latency.sh: runs a continious ping in different scenarios, such as: idle, iPerf3 on one UE, iPerf3 on all UEs, iPerf3 on all UEs except one, and more.

To use the script, on the UPF run /iperf3-latency.sh <list of IPs:port iPerf3 servers>


# Gradiant 5G Charts

This repo mantains helm charts generated by [Gradiant](https://www.gradiant.org) for its Lab5G platform.

Gradiant is actively researching and developing Cloud-Native Network Functions (CNFs) with special focus on 5G network and evolvable to 6G technologies.

Follow the README.md of each chart to evaluate the technologies in your kubernetes cluster.

## Install chart from DockerHub repository

charts in `charts/`` folder are packaged and available at Gradiant's DockerHub repo:  

[https://hub.docker.com/u/gradiant](https://hub.docker.com/u/gradiant)

You can pull and save locally the chart. For example:

```bash
helm pull oci://registry-1.docker.io/gradiant/open5gs --version 2.2.0
```

You can directly install the chart. For example, to install open5gs:

```bash
helm install open5gs oci://registry-1.docker.io/gradiant/open5gs --version 2.2.0
```

## Check out our tutorials

We have developed some tutorials meant to **guide you through the combined deployment of different technologies**. It is an easy and quick way of testing these technologies and exploring how they work.

These tutorials make use of charts available at this repo, and their corresponding documentation can be found at:
[https://gradiant.github.io/5g-charts/](https://gradiant.github.io/5g-charts/)

## Development

- clone repo
- adjust given chart
- bump chart version if required
- run tests
- create pull request with issue id, attach test results if possible

### Requirements

- linting requires docker
- running test-install.sh requires docker and kubernetes-in-docker.
- `tee` console tool to output to the console and file in the same time

## Linting and testing full deployment

We use helm [chart-testing](https://github.com/helm/chart-testing) running a docker image.

An example to test specific chart lint and install, send console logs also to the log file `reports/*.log`:

```bash
scripts/lint-install.sh open5gs | tee reports/open5gs.log
```
